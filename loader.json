let CONFIG = null;

async function caricaConfigDaLoader() {
  try {
    const loaderUrl = localStorage.getItem("loader_url") || "/loader.json";
    console.log("üì¶ Carico loader da:", loaderUrl);

    const loaderRes = await fetch(loaderUrl);
    if (!loaderRes.ok) throw new Error("‚ùå Loader non trovato");
    const loader = await loaderRes.json();

    console.log("üîó Config URL:", loader.config_url);
    const configRes = await fetch(loader.config_url);
    if (!configRes.ok) throw new Error("‚ùå Config non trovato");
    CONFIG = await configRes.json();

    console.log("‚úÖ CONFIG ricevuto:", CONFIG);

    // üîÅ Caricamento logo da Google Drive (senza proxy)
    const logoId = CONFIG.ui_options?.logo_id;
    const logoFileId = CONFIG.files?.[logoId];
    if (logoFileId) {
      const logoUrl = `https://drive.google.com/uc?export=view&id=${logoFileId}`;
      const logoImg = document.getElementById("logo-asd");
      if (logoImg) {
        logoImg.src = logoUrl;
        console.log("üñºÔ∏è Logo caricato:", logoUrl);
      } else {
        console.warn("‚ö†Ô∏è Elemento #logo-asd non trovato nel DOM.");
      }
    } else {
      console.warn("‚ö†Ô∏è Logo ID non trovato nel config.");
    }

  } catch (err) {
    console.error("‚ùå Errore caricamento config:", err);
  }
}

window.onload = caricaConfigDaLoader;
